<script>
export default {
  name: 'advancedMode',
  data(){
    return{
      api_key: '39d7058ef12ab5dae395f420fd79ec5a',
      url_base: 'http://api.openweathermap.org/data/2.5/',
      isWeatherLoaded: false,
      currentTime: '',
      currentDay: "",
      currentDate: "",
      currentMonth: "",
    }
  },
  created() {
    this.fetchWeather()
    this.startUpdatingTime();
  },
  methods:{
        
    async fetchWeather(){
      try {
        const response = await fetch(`${this.url_base}weather?q=${this.$route.params.city}&units=metric&APPID=${this.api_key}`);
        const results = await response.json();
        this.setResults(results);
        await this.fetchFiveDayForecast();
        await this.fetchAirQuality();
        this.isWeatherLoaded = true;
      } catch (error) {
        console.error('Error fetching weather data:', error);
      }
    },
    fetchFiveDayForecast(){
      const { lat, lon } = this.weather.coord;
      fetch(`${this.url_base}forecast?lat=${lat}&lon=${lon}&appid=${this.api_key}`)
        .then(res => res.json()) 
        .then(response => {
          console.log('respuesta',response);
          this.setFiveDayForecastResults(response);
        })
        .catch(error => {
          console.error('Error fetching 5 day weather forecast:', error);
        });
    },
    fetchAirQuality(){
      const { lat, lon } = this.weather.coord;
      fetch(`${this.url_base}air_pollution?lat=${lat}&lon=${lon}&appid=${this.api_key}`)
        .then(res => res.json()) 
        .then(response => {
          console.log('respuesta',response);
          this.setAirQualityResults(response);
        })
        .catch(error => {
          console.error('Error fetching air pollution data:', error);
        });
    },
    setResults (results){
      this.weather = results;
    },
    setFiveDayForecastResults(response){
      this.five_day_forecast = response
      console.log('five day forecast', this.five_day_forecast)
      //console.log(this.five_day_forecast.list[0].pop)
    },
    setAirQualityResults(response){
      this.air_quality = response
      console.log('air quality', this.air_quality)
      //console.log(this.air_quality.list[0].main.aqi)
    },
    updateCurrentTime() {
      const now = new Date();
      const hours = now.getHours();
      const minutes = now.getMinutes();
      this.currentTime = `${hours}:${minutes}`;
      const daysOfWeek = ["SUNDAY", "MONDAY", "TUESDAY", "WEDNESDAY", "THURSDAY", "FRIDAY", "SATURDAY"];
      const dayIndex = now.getDay();
      this.currentDay = daysOfWeek[dayIndex];

      const date = now.getDate();
      this.currentDate = date < 10 ? `0${date}` : date.toString();

      const monthIndex = now.getMonth();
      const months = ["JAN", "FEB", "MAR", "APR", "MAY", "JUN", "JUL", "AUG", "SEP", "OCT", "NOV", "DEC"];
      this.currentMonth = months[monthIndex];
    },
    startUpdatingTime() {
      this.updateCurrentTime();

    
      setInterval(() => {
        this.updateCurrentTime();
      }, 1000);
    },
    getWeatherIcon() {
    const weatherMain = this.weather.weather[0].main.toLowerCase();
    
    const iconMap = {
      'clear': '../assets/img/sunnyImg.svg',
      'clouds': '../assets/img/cloudImg.svg',
      'rain': '../assets/img/rainImg.svg',
      'thunderstorm':'../assets/img/thunderImg.png',
      'snow':'../assets/img/snowImg.png',
      'mist':'../assets/img/mistImg.png',
    };

    return iconMap[weatherMain] || '../assets/img/sunnyImg.svg';
  }


  }
  
}
</script>
<template>
  <main>
    <RouterLink :to="{ name: 'basicModeDashboard' }" id = 'backBtn'><font-awesome-icon icon="fa-solid fa-chevron-left" id = 'backIcon'/></RouterLink>
    <section v-if="isWeatherLoaded" id="basicInfoToday">
    </section>
    <section v-if="weather" id='basicInfoToday'>
      <div id = 'containerBasicWeatherInfo'>
        <img :src="getWeatherIcon()" id = 'todaysWeatherIconAdvacedMode'>
        <div id = 'headerBasicWeatherInfo'>
          <h1 id = 'currentTemperatureHeader'>{{Math.round(weather.main.temp)}}°</h1>
          <h2 id = 'degreeTypeHeader'>C</h2>
          <div id = 'locationAdvancedMode'>
            <font-awesome-icon icon="location-dot" style="color: #303030;" id ='locationIconAdvancedMode' />
            <h2 id = 'locationCityAdvancedMode'>{{ weather.name }}</h2>
            <p v-if="weather.main" id='time'>{{ currentTime }}</p>
          </div>
        </div>
      </div>
      <div id = 'containerTodayCalendar'>
        <div id = 'month'>{{ currentMonth }}</div>
        <div id = 'dateAndDayAdvancedMode'>
          <h2 id = 'dateAdvancedMode'>{{ currentDate }}</h2>
          <h3 id = 'dayAdvancedMode'>{{ currentDay }}</h3>
        </div>
      </div>
    </section>
    <section id = 'citiesContainer'>
      <div class = 'cityContainer'>
        <div class = 'cityContainerHeader'>
          <div class = 'cityName'>Lisbon</div> 
          <div class = 'countryName'>Portugal</div>
        </div>
        <img class = 'cityWeatherIcon' src  = '../assets/img/sunnyImg.svg'>
        <div class = 'cityContainerTemperature'>
          <h2 class = 'currentTempCityContainer'>19°</h2>
          <h3 class = 'maxTempCityContainer'>/23°</h3>
        </div>
      </div>
      <div class = 'cityContainer'>
        <div class = 'cityContainerHeader'>
          <div class = 'cityName'>Cape Town</div> 
          <div class = 'countryName'>South Africa</div>
        </div>
        <img class = 'cityWeatherIcon' src  = '../assets/img/sunnyImg.svg'>
        <div class = 'cityContainerTemperature'>
          <h2 class = 'currentTempCityContainer'>36°</h2>
          <h3 class = 'maxTempCityContainer'>/41°</h3>
        </div>
      </div>
      <div class = 'cityContainer'>
        <div class = 'cityContainerHeader'>
          <div class = 'cityName'>Bogotá</div> 
          <div class = 'countryName'>Colombia</div>
        </div>
        <img class = 'cityWeatherIcon' src  = '../assets/img/sunnyImg.svg'>
        <div class = 'cityContainerTemperature'>
          <h2 class = 'currentTempCityContainer'>24°</h2>
          <h3 class = 'maxTempCityContainer'>/31°</h3>
        </div>
      </div>
      <div class = 'cityContainer'>
        <div class = 'cityContainerHeader'>
          <div class = 'cityName'>Madrid</div> 
          <div class = 'countryName'>Spain</div>
        </div>
        <img class = 'cityWeatherIcon' src  = '../assets/img/sunnyImg.svg'>
        <div class = 'cityContainerTemperature'>
          <h2 class = 'currentTempCityContainer'>18°</h2>
          <h3 class = 'maxTempCityContainer'>/21°</h3>
        </div>
      </div>
    </section>
    <section id = 'containerNimbusNudgesAdvancedMode'>
        <div id = 'headerNimbusNudges'>
          <h3 id = 'titleNimbusNudges'>Nimbus Nudges</h3>
          <div id = 'buttonsHeaderNimbusNudges'>
            <button id = 'leftNimbusNudges'><font-awesome-icon icon="fa-solid fa-arrow-left " style="color: #303030;"  /></button>
            <button id = 'rightNimbusNudges'><font-awesome-icon icon="fa-solid fa-arrow-right" style="color: #303030;" /></button>
          </div>
        </div>
         <div id = 'nimbusNudgesData'></div>
         <div id = 'buttonsOptionsNimbusNudges'>
          <button id = 'allClearBtn'>ALL CLEAR!</button>
          <button id = 'quietTheSkiesBtn'>QUIET THE SKIES</button>
         </div>
        <p></p>
      </section>
      <section id = 'temperatureGraphContainerAdvancedMode'></section>
      <section id = 'weatherInfoAdvancedModeContainer'>
        <div id = 'windContainerAdvancedMode'>
          <div class = 'headerContainers'>
            <h2 class = 'weatherInfoContainerHeader' id = 'windTitle' >Wind</h2>
            <img class = 'weatherInfoIllustrations' alt = 'Wind' src = '../assets/img/windIcon.svg'>
          </div>
          <h3 class = 'dataContainers'>{{ weather.wind.speed }} m/s</h3>
          
        </div>
        <div id = 'rainContainerAdvancedMode'>
          <div class = 'headerContainers'>
            <h2 class = 'weatherInfoContainerHeader' id = 'rainTitle'>Rain</h2>
            <img class = 'weatherInfoIllustrations' alt = 'Rain' src = '../assets/img/rainIcon.svg'>
          </div>
          <h3 class = 'dataContainers'> {{ five_day_forecast && five_day_forecast.list ? Math.round(five_day_forecast.list[0].pop * 100) :'' }}  %</h3>
        </div>
        <div id = 'humidityContainerAdvancedMode'>
          <div class = 'headerContainers'>
            <h2 class = 'weatherInfoContainerHeader' id = 'humidityTitle'>Humidity</h2>
            <img class = 'weatherInfoIllustrations' alt = 'Humidity' src = '../assets/img/humidityIcon.svg'>
          </div>
          <h3 class = 'dataContainers'>{{ weather.main.humidity }} %</h3>
        </div>
        <div id = 'wavesContainerAdvancedMode'>
          <div class = 'headerContainers'>
            <h2 class = 'weatherInfoContainerHeader' id = 'wavesTitle'>Sea Levels</h2>
            <img class = 'weatherInfoIllustrations' alt = 'Waves' src = '../assets/img/wavesIcon.png'>
          </div>
          <h3 class='dataContainers' v-if="weather.main && weather.main.sea_level">{{ weather.main.sea_level }} hPa</h3>
          <h3 class='dataContainers' v-else>N/A</h3>
        </div>
        <div id = 'visibilityContainerAdvancedMode'>
          <div class = 'headerContainers'>
            <h2 class = 'weatherInfoContainerHeader' id = 'visibilityTitle'>Visibility</h2>
            <img class = 'weatherInfoIllustrations' alt = 'Visibility' src = '../assets/img/visibilityIcon.png'>
          </div>
          <h3 class = 'dataContainers'>{{ weather.visibility / 1000 }} km</h3>
        </div>
        <div id = 'pressureContainerAdvancedMode'>
          <div class = 'headerContainers'>
            <h2 class = 'weatherInfoContainerHeader' id ='pressureTitle'>Pressure</h2>
            <img class = 'weatherInfoIllustrations' alt = 'Pressure' src = '../assets/img/pressureIcon.svg'>
          </div>
          <h3 class = 'dataContainers'>{{weather.main.pressure}}hPa</h3>
        </div>
      </section> 

  </main>
</template>
<style>


#backBtn{
width: 3.125rem;
  height: 3.125rem;
  border-radius: 100px;
  border: 0.1em solid #303030;
  cursor: pointer;
  position: absolute;
  top: 1.13em;
  left: 1.37em;
  display: flex;
  justify-content: center;
  align-items: center;
}
#backIcon{
  font-size: 1.5em;
}
#containerNimbusNudgesAdvancedMode{
  position: absolute;
  left: 63em;
  top: 7em;
  width: 15.5rem;
  height: 14.312rem;
  flex-shrink: 0;
  border-radius: 1.25rem;
  border: 1px solid var(--Textual-Elements-Midnight-Onyx, #303030);
  background: var(--Secondary-Color-Palette-Sky-Wash, #ADD8FB);
}
#containerBasicWeatherInfo{
  width: 21.0625rem;
height: 10.0625rem;
flex-shrink: 0;
border-radius: 1.25rem;
border: 1px solid var(--Textual-Elements-Midnight-Onyx, #303030);
background: var(--secondary-color-palette-20-saturation-sky-wash-20-sat, #DFEFFB);
position: absolute;
left: 2em;
top:2.37em;
display: flex;
}
#todaysWeatherIconAdvacedMode{
  max-width: 10.5rem;
  height: auto;
  z-index: 2;
  margin-left: 2em;
}
#currentTemperatureHeader{
  color: #303030;
  font-family: Recoleta;
  font-size: 6rem;
  font-style: normal;
  font-weight: 600;
  line-height: normal;
  align-self: start;
  margin: 0;
  margin-bottom: 0.2em;
}
#degreeTypeHeader{
  color: #303030;
  font-family: Recoleta;
  font-size:3rem;
  font-style: normal;
  font-weight: 600;
  line-height: normal;
  position: absolute;
  left:2em;
  top: -0.2em
}
#headerBasicWeatherInfo{
  width: 8rem;
  height: 8.1875rem;
  position: absolute;
  top:1.5em;
  right:1.25em;
  z-index: 3;
  display: flex;
  flex-direction: column-reverse;
}
#locationAdvancedMode{
  width: 100%;
  height: 2em;
  position: absolute;
  bottom: 0em;
  margin-bottom: 1em;
  display: flex;
  justify-content: space-around;
  align-items: center;
}
#locationCityAdvancedMode, #locationIconAdvancedMode{
  align-items: center;
  color: #303030;
  font-family: Asap;
  font-size: 1.25rem;
  font-style: normal;
  font-weight: 700;
  line-height: normal;
}
#locationCity{
  margin-right: 2em;
}
#time{
  color: #303030;
  font-family: Recoleta;
  font-size: 1.25rem;
  font-style: normal;
  font-weight: 300;
  line-height: normal;
}
#containerTodayCalendar{
  width: 7.875rem;
  height: 9.625rem;
  flex-shrink: 0;
  border-radius: 1.25rem;
  border: 1px solid var(--Textual-Elements-Midnight-Onyx, #303030);
  background: #F2E6DD;
  position: absolute;
  top:2.37em;
  right:2.19em;
  display: flex;
  flex-direction: column;
  align-items: center;
}
#month{
  width: 7.875rem;
  height: 2.75rem;
  flex-shrink: 0;
  border-radius: 1.25rem 1.25rem 0rem 0rem;
  border: 1px solid #000;
  background: #E74727;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #303030;
  font-family: Asap;
  font-size: 1.25rem;
  font-style: normal;
  font-weight: 800;
  line-height: normal;
}
#dateAndDayAdvancedMode{
  width: 7.875em;
  height: 7em;
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 0;
}
#dateAdvancedMode{
  color: #303030;
  font-family: Recoleta;
  font-size: 3.75rem;
  font-style: normal;
  font-weight: 700;
  line-height: normal;
  margin: 0;
}
#dayAdvancedMode{
  color: #303030;
  font-family: Asap;
  font-size: 1.25rem;
  font-style: normal;
  font-weight: 400;
  line-height: normal;
  margin: 0;  
}
#basicInfoToday{
  width: 35.4375rem;
  height: 14.312rem;
  flex-shrink: 0;
  border-radius: 1.25rem;
  border: 1px solid var(--Textual-Elements-Midnight-Onyx, #303030);
  background: var(--Primary-Color-Palette-Sunbeam-Gold, #FAC54B);
  position: absolute;
  left: 8.44em;
  top:7em;
}
#citiesContainer{
  width: 15.5rem;
  height:14.312rem;
  flex-shrink: 0;
  border-radius: 1.25rem;
  border: 1px solid var(--Textual-Elements-Midnight-Onyx, #303030);
  background: var(--secondary-color-palette-20-saturation-orchid-flush-20-sat, #E15CC9);
  position: absolute;
  left:45.75em;
  top:7em;
  display: flex;
  align-items: center;
  flex-direction: column;
  justify-content: space-evenly;
  flex-wrap: wrap;
  
}
.cityContainer{
  width:6rem;
  height:6rem;
  flex-shrink: 0;
  border-radius: 1.25rem;
  border: 1px solid var(--Textual-Elements-Midnight-Onyx, #303030);
  background: #F2E6DD;
  display: flex;
  align-items: center;
  flex-direction: column;
}
.cityContainerHeader{
  width: 100%;
  margin-top: 0.5em;
  justify-self: flex-start;
  height: 1.55625rem;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  z-index: 5;
}

.cityName{
  color: #E65E2A;
  font-family: Asap;
  font-size: 0.875rem;
  font-style: normal;
  font-weight: 700;
  line-height: normal;
}
.countryName{
  color: #303030;
  font-family: Asap;
  font-size: 0.625rem;
  font-style: normal;
  font-weight: 700;
  line-height: normal;
}
.cityWeatherIcon{
  max-width: 4em;
  height: auto;
  z-index: 2;
}
.cityContainerTemperature{
  display: flex;
  flex-direction: row ;
  align-items: center;
  height: 1em;
}
.currentTempCityContainer{
  color: #303030;
text-align: right;
font-family: Asap;
font-size: 1.5625rem;
font-style: normal;
font-weight: 700;
line-height: normal;
}

.maxTempCityContainer{
  color: #303030;
text-align: right;
font-family: Asap;
font-size: 0.9rem;
font-style: normal;
font-weight: 400;
line-height: normal;
margin: 0;
margin-left: -0.5em;
margin-bottom: -0.5em;
}
#temperatureGraphContainerAdvancedMode{
  width: 34.125rem;
  height: 17.9375rem;
  flex-shrink: 0;
  border-radius: 1.25rem;
  border: 1px solid var(--Textual-Elements-Midnight-Onyx, #303030);
  background: #F2E6DD;
  position: absolute;
  left: 8.44em;
  top:23.62em;
}

#weatherInfoAdvancedModeContainer{
  display: flex;
  width: 11.25rem;
  height: 19.6875rem;
  flex-shrink: 0;
  position: absolute;
  left: 45.75em;
  top:23.62em;
  flex-direction: column;
}


#weatherInfoAdvancedModeContainer > div:not(#pressureContainerAdvancedMode):hover {
  transform: translateY(-1.5em); 
  transition: transform 0.3s ease-in-out;
}




#windContainerAdvancedMode, #rainContainerAdvancedMode, #humidityContainerAdvancedMode,#wavesContainerAdvancedMode, #visibilityContainerAdvancedMode, #pressureContainerAdvancedMode{
  width: 11.25rem;
  height: 8rem;
  flex-shrink: 0;
  border-radius: 1.25rem;
  border: 1px solid var(--Textual-Elements-Midnight-Onyx, #303030);
  display: flex;
  align-items: flex-start;
  flex-direction: column;
}
#windContainerAdvancedMode{
  background: #C8BDFF;
}
#rainContainerAdvancedMode{
  background: #43AA8B;
  position: absolute;
  top:2.50em;
}
#humidityContainerAdvancedMode{
  background: #FFEA8A;
  position: absolute;
  top:5em;
}
#wavesContainerAdvancedMode{
  background: #F4F4F4;
  position: absolute;
  top:7.50em;
}
#visibilityContainerAdvancedMode{
  background: #FFA646;
  position: absolute;
  top:10em;
}

#pressureContainerAdvancedMode{
  background: #FFBEED;
  position: absolute;
  top:13em;
  height: 5rem;
}

.headerContainers{
  display: flex;
  width: 80%;
  justify-content: space-between;
  height: 2em;
  align-items: center;
  padding-left: 1.13em;
  padding-right: 0.81em;
  color: #303030;
  font-family: Asap;
  font-size: 1rem;
  font-style: normal;
  font-weight: 700;
  line-height: normal;
  padding-top: 0.40em;
  flex-direction: row;
}
#pressureTitle{
  color: #B21C29;
}
#windTitle{
  color: #685E9A;
}
#rainTitle{
  color: #185850;
}
#humidityTitle{
  color: #826022;
}
#wavesTitle{
  color: #303030;
}
#visibilityTitle{
  color: #9B4F19;
}

.dataContainers{
  width: auto;
  height: auto;
  flex-shrink: 0;
    color: #484848;
  font-family: Asap;
  font-size: 1.25rem;
  font-style: normal;
  font-weight: 600;
  line-height: normal;
  display: flex;
  justify-content: center;
  margin: 0;
  margin-top: 0.2em;
  margin-left: 1.13em;
}
/*
.weatherInfoIllustrations{
  background-color: red;
  position: absolute;
  right: 1.6em;
}*/
</style>